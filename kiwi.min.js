(function(){function require(p){var path=require.resolve(p),mod=require.modules[path];if(!mod)throw new Error('failed to require "'+p+'"');return mod.exports||(mod.exports={},mod.call(mod.exports,mod,mod.exports,require.relative(path))),mod.exports}require.modules={},require.resolve=function(path){var orig=path,reg=path+".js",index=path+"/index.js";return require.modules[reg]&&reg||require.modules[index]&&index||orig},require.register=function(path,fn){require.modules[path]=fn},require.relative=function(parent){return function(p){if("."!=p.charAt(0))return require(p);var path=parent.split("/"),segs=p.split("/");path.pop();for(var i=0;i<segs.length;i++){var seg=segs[i];".."==seg?path.pop():"."!=seg&&path.push(seg)}return require(path.join("/"))}},require.register("cache.js",function(module,exports,require){function Cache(){this._cache={}}Cache.prototype.cache=function(key,value){if(_.isUndefined(value))return;this._cache[key]=value},Cache.prototype.get=function(key){return this._cache[key]},module.exports=exports=Cache}),require.register("compiler.js",function(module,exports,require){var token=require("./token"),utils=require("./utils"),TAG_OPENING_DELIMITER="{{",TAG_CLOSING_DELIMITER="}}",TAG_OPENING_DELIMITER_LENGTH=TAG_OPENING_DELIMITER.length,TAG_NAME_MATCH=/^(\/)?\s*([^\s\}\(]*)/i,Compiler=module.exports=function(template){this.template=template,this.source=template.template,this.options=template.options,this.__compilationEnd=[]};Compiler.prototype.compile=function(callback){var _this=this;function onProcessed(err,processed){if(err)return callback(err);_this._tokenize(processed,onTokenized)}function onTokenized(err,tokenized){if(err)return callback(err);tokenized.compile(_this,onCompiled)}function onCompiled(err,compiled){if(err)return callback(err);callback(null,new Function("__template","__tools","_","__data","__helpers","__callback",compiled))}utils.applyAll(this.source,token.tagBeforeProcessors,[this],onProcessed)},Compiler.prototype._tokenize=function(source,callback){var workingSource=source,currentToken=new token.RootToken,rootToken=currentToken,inToken=!1,currentPart;for(;;){var nextInflexion=workingSource.indexOf(inToken?TAG_CLOSING_DELIMITER:TAG_OPENING_DELIMITER);if(nextInflexion==-1){this._pushLiteralToken(rootToken,currentToken,workingSource);break}inToken&&(nextInflexion+=TAG_OPENING_DELIMITER_LENGTH),currentPart=workingSource.slice(0,nextInflexion),workingSource=workingSource.slice(nextInflexion);if(!inToken)this._pushLiteralToken(rootToken,currentToken,currentPart);else{currentPart=currentPart.slice(2,-2).trim();try{currentToken=this._pushToken(rootToken,currentToken,currentPart)}catch(err){return callback(err)}}inToken=!inToken}if(rootToken!==currentToken)return callback(new Error("Tokenization error: unexpected end of file, expedted `"+currentToken.tag.tagName+"`."));callback(null,rootToken)},Compiler.prototype._pushLiteralToken=function(root,parent,literal){if(!literal.length)return;parent.children.push(new token.LiteralToken(literal,root))},Compiler.prototype._pushToken=function(root,current,tag){var match=tag.match(TAG_NAME_MATCH),tagName=match[2],openingTag=match[1]!=="/",tagType=current.lookupTag(tagName);if(!tagType)throw new Error("Tokenization error: Unknown tag `"+tagName+"`.");if(tagType.isIntermediate){current.tagType.isIntermediate&&(current=current.parent);var newToken=new token.IntermediateToken(tag,tagType,root,current,[],this.options);return current.intermediate.push(newToken),newToken}if(tagType.isBlock){if(openingTag){var newToken=new token.BlockToken(tag,tagType,root,current,[],this.options);return current.children.push(newToken),newToken}if(!current.parent)throw new Error("Tokenization error: unexpected `"+tagName+"` tag at root level.");current.tagType.isIntermediate&&(current=current.parent);if(current.tagType.tagName!==tagName)throw new Error("Tokenization error: unexpected `"+tagName+"` tag, expected `"+current.tag.tagName+"`.");return current.parent}if(!openingTag)throw new Error("Tokenization error: `"+tagName+"` is not a block tag.");var newToken=new token.LeafToken(tag,tagType,root,current,this.options);return current.children.push(newToken),current}}),require.register("filter.js",function(module,exports,require){function filter(input,filters){var unknownFilter;filters.forEach(function(filterName){var filterArgs=[];_.isArray(filterName)&&(filterArgs=filterName.slice(1),filterName=filterName[0]);var filterFunction=module.exports.filters[filterName];if(!filterFunction)return unknownFilter=filterName,!1;input=filterFunction.apply(this,[input].concat(filterArgs))});if(unknownFilter)throw new Error("Rendering error: Unknown filter `"+unknownFilter+"`.");return input}module.exports=filter;var filters=module.exports.filters={};function loadFilters(loadedFiles){loadedFiles=loadedFiles||frame.files.requireDir(__dirname+"/filters/");for(file in loadedFiles){var fileFilters=loadedFiles[file];for(filter in fileFilters)filters[filter]=fileFilters[filter]}}if(typeof window!="undefined"){var files=["base","datetime"],acc={};_.each(files,function(file){acc[file]=require("./filters/"+file)}),loadFilters(acc)}}),require.register("filters/base.js",function(module,exports,require){var tools=require("../tools"),utils=require("../utils");module.exports.escape=function(input){if(input===null||input===undefined)return"";if(utils.isIterable(input)){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.escape(value)}),acc}return tools.escape(input)},module.exports.escapeIfUnsafe=function(input){if(input===null||input===undefined)return"";if(utils.isIterable(input)){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.escapeIfUnsafe(value)}),acc}return tools.escapeIfUnsafe(input)},module.exports.capitalize=function(input){if(utils.isIterable(input)){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.capitalize(value)}),acc}return input=input.toString(),input.charAt(0).toUpperCase()+input.slice(1)},module.exports.upper=function(input){if(utils.isIterable(input)){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.upper(value)}),acc}return input.toString().toUpperCase()},module.exports.lower=function(input){if(utils.isIterable(input)){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.lower(value)}),acc}return input.toString().toLowerCase()},module.exports.json=function(input){return JSON.stringify(input)},module.exports.add=function(input,operand){if(typeof input=="object"){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.add(value,operand)}),acc}return parseFloat(input)+parseFloat(operand)},module.exports.subtract=function(input,operand){return module.exports.add(input,-parseInt(operand))},module.exports.mul=function(input,operand){if(typeof input=="object"){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.mul(value,operand)}),acc}return parseFloat(input)*parseFloat(operand)},module.exports.div=function(input,operand){if(typeof input=="object"){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.div(value,operand)}),acc}return parseFloat(input)/parseFloat(operand)},module.exports.incr=function(input,operand){return module.exports.add(input,1)},module.exports.decr=function(input,operand){return module.exports.add(input,-1)},module.exports.round=function(input){if(typeof input=="object"){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.round(value,operand)}),acc}return Math.round(input)},module.exports.floor=function(input){if(typeof input=="object"){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.floor(value,operand)}),acc}return Math.floor(input)},module.exports.ceil=function(input){if(typeof input=="object"){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.ceil(value,operand)}),acc}return Math.ceil(input)},module.exports.cut=function(input,needle){if(typeof input=="object"){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.cut(value,needle)}),acc}return input.toString().replace(needle,"")},module.exports.addslashes=function(input){if(utils.isIterable(input)){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.capitalize(value)}),acc}return input.toString().replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"').replace(/\0/g,"\\0")},module.exports.stripslashes=function(input){if(utils.isIterable(input)){var acc={};return _.each(input,function(value,key){acc[key]=module.exports.capitalize(value)}),acc}return input.toString().replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\0/g,"\0").replace(/\\\\/g,"\\")},module.exports.first=function(input){return typeof input=="object"&&!_.isArray(input)?"":_.isString(input)?input.substr(0,1):_.first(input)},module.exports.last=function(input){return typeof input=="object"&&!_.isArray(input)?"":_.isString(input)?input.slice(-1):_.last(input)},module.exports.length=function(input){return typeof input=="object"?_.keys(input).length:input.length},module.exports.reverse=function(input){return _.isArray(input)?input.reverse():input},module.exports.join=function(input,separator){if(_.isArray(input))return input.join(separator);if(typeof input=="object"){var acc=[];return _.each(input,function(value,key){acc.push(value)}),acc.join(separator)}return input},module.exports.urlencode=function(input){return encodeURIComponent(input)},module.exports.urldecode=function(input){return decodeURIComponent(input)},module.exports.replace=function(input,search,replacement,flags){return input.replace(new RegExp(search,flags),replacement)}}),require.register("filters/datetime.js",function(module,exports,require){module.exports.timeago=function(input){return moment(input).fromNow()},module.exports.relativedate=function(input){return moment(input).calendar()},module.exports.date=function(input,pattern){return moment(input).format(pattern)}}),require.register("kiwi.js",function(module,exports,require){var Template=module.exports.Template=require("./template");module.exports.tools=require("./tools"),module.exports.version="0.1.2"}),require.register("tags/block.js",function(module,exports,require){var BLOCK_PARSE_RE=/^block\s+([^\s]+)$/;module.exports.tags={};var blockTag=module.exports.tags.block={};blockTag.isBlock=!0,blockTag.compile=function(token,compiledContents,compiledIntermediate,compiler,callback){var parsed=token.tag.match(BLOCK_PARSE_RE);if(!parsed)return callback(new Error("Compilation error: Unable to parse tag `"+token.tag+"`."));var name=parsed[1],compiled='(function(parentAcc) {var __acc = [];if(_.isUndefined(__blocks["'+name+'"])) {'+compiledContents+"} else {"+'__acc.push(__blocks["'+name+'"])'+"}"+'var __joined = __acc.join("");'+"parentAcc.push(__joined);"+'__blocks["'+name+'"] = __joined;'+"})(__acc);";callback(null,compiled)}}),require.register("tags/comment.js",function(module,exports,require){var COMMENT_RE=/\{\{\s*comment\s*\}\}((.|\n)*?)\{\{\s*\/\s*comment\s*\}\}/g;module.exports.tags={};var commentTag=module.exports.tags["#"]={};commentTag.isBlock=!1,commentTag.compile=function(token,compiledContents,compiler,callback){callback(null,"")},commentTag.beforeProcessor=function(source,compiler,callback){source=source.replace(COMMENT_RE,""),callback(null,source)}}),require.register("tags/each.js",function(module,exports,require){var EACH_PARSE_RE=/^each(?:\(([^\)\s]+)\s*\,\s*([^\)\s]+)\s*\))?\s+(.*)$/;module.exports.tags={};var eachTag=module.exports.tags.each={},intermediateTags=eachTag.intermediateTags={},emptyTag=intermediateTags.empty={};eachTag.isBlock=!0,eachTag.headDeclarations="var _eachLoop;",eachTag.compile=function(token,compiledContents,compiledIntermediate,compiler,callback){var parsed=token.tag.match(EACH_PARSE_RE);if(!parsed)return callback(new Error("Compilation error: Unable to parse tag `"+token.tag+"`."));var elementVariable=parsed[1]||"$value",indexVariable=parsed[2]||"$index",collection=parsed[3],ifEmpty;if(compiledIntermediate.length){if(compiledIntermediate.length>1)return callback(new Error("Compilation Error: Too many intermediate tags for `each`."));if(token.intermediate[0].tag!=="empty")return callback(new Error("Compilation Error: Unexpected tag `"+token.intermediate[0].tag+"`."));ifEmpty=compiledIntermediate[0]}var compiled="(function(__parentEachLoop) {";token.options.strict?compiled+="__tmp = "+collection+";":compiled+="try {__tmp = "+collection+"} catch(__err) {"+"if(__err instanceof ReferenceError) {"+"__tmp = [];"+"} else {"+"throw __err;"+"}"+"}",compiled+="var __eachLoopLength = _.size(__tmp);",ifEmpty&&(compiled+="if(__eachLoopLength) {"),token.options.eachCounters?compiled+="var __eachLoopCounter = 0;_.each(__tmp, function("+elementVariable+","+indexVariable+"){"+"_eachLoop = {"+"size: __eachLoopLength,"+"counter0: __eachLoopCounter,"+"counter: __eachLoopCounter + 1,"+"revcounter0: __eachLoopLength - __eachLoopCounter - 1,"+"revcounter: __eachLoopLength - __eachLoopCounter,"+"first: __eachLoopCounter === 0,"+"last: __eachLoopCounter + 1 === __eachLoopLength,"+"parentLoop: __parentEachLoop"+"};"+compiledContents+"__eachLoopCounter++;"+"});":compiled+="_.each(__tmp, function("+elementVariable+","+indexVariable+"){"+compiledContents+"});",ifEmpty&&(compiled+="} else {"+ifEmpty+"}"),compiled+="})(_eachLoop);",callback(null,compiled)}}),require.register("tags/extend.js",function(module,exports,require){var utils=require("../utils"),EXTEND_PARSE_RE=/^extend\s+(.+)$/;module.exports.tags={};var extendTag=module.exports.tags.extend={},helpers=module.exports.helpers={};extendTag.isBlock=!1,extendTag.compile=function(token,compiledContents,compiler,callback){if(token.root.children[0]!==token)return callback(new Error("Compilation error: Extend tag must be defined at the very beginning of the template."));var parsed=token.tag.match(EXTEND_PARSE_RE);if(!parsed)return callback(new Error("Compilation error: Unable to parse tag `"+token.tag+"`."));var name=parsed[1],compiled="var __originalCallback = __callback;__callback = function(err, compiled) {__helpers.extend("+name+", __compiled, __template,"+"__data, __originalCallback);"+"};";callback(null,compiled)},helpers.extend=function(name,compiled,template,data,callback){function onRendered(err,rendered){if(err)return callback(err);callback(null,rendered)}template._renderRelative(name,data,compiled,onRendered)}}),require.register("tags/if.js",function(module,exports,require){var IF_PARSE_RE=/^if\s+(.*)$/,ELSE_PARSE_RE=/^else(?:\s+(.*))?$/;module.exports.tags={};var ifTag=module.exports.tags.if={},intermediateTags=ifTag.intermediateTags={},elseTag=intermediateTags.else={};function createIfCondition(condition,strict){var compiled;return strict?compiled="if("+condition+")":compiled="try {__tmp = "+condition+"} catch(__err) {"+"if(__err instanceof ReferenceError) {"+"__tmp = false;"+"} else {"+"throw __err;"+"}"+"}"+"if(__tmp)",compiled}ifTag.isBlock=!0,ifTag.compile=function(token,compiledContents,compiledIntermediate,compiler,callback){var parsed=token.tag.match(IF_PARSE_RE);if(!parsed)return callback(new Error("Compilation error: Unable to parse tag `"+token.tag+"`."));var condition=parsed[1],appendEnd=["}"],compiled=createIfCondition(condition,token.options.strict);compiled+="{"+compiledContents;var err;_.each(token.intermediate,function(intermediate,index){var intermediateTag=intermediate.tag,compiledIntermediateTag=compiledIntermediate[index],parsed=intermediateTag.match(ELSE_PARSE_RE);if(!parsed){err=new Error("Compilation error: Unable to parse tag `"+token.tag+"`.");return}var condition=parsed[1];condition?(appendEnd.push("}"),compiled+="} else {"+createIfCondition(condition,token.options.strict)+"{"):compiled+="} else {",compiled+=compiledIntermediate[index]});if(err)return callback(err);compiled+=appendEnd.join(""),callback(null,compiled)}}),require.register("tags/include.js",function(module,exports,require){var utils=require("../utils"),INCLUDE_PARSE_RE=/^include\s+(.+)$/;module.exports.tags={};var includeTag=module.exports.tags.include={},helpers=module.exports.helpers={};includeTag.isBlock=!1,includeTag.compile=function(token,compiledContents,compiler,callback){var parsed=token.tag.match(INCLUDE_PARSE_RE);if(!parsed)return callback(new Error("Compilation error: Unable to parse tag `"+token.tag+"`."));var name=parsed[1];compiler.__compilationEnd.unshift("});");var compiled="__helpers.include("+name+", __template,"+"__data, function(err, rendered) {"+"__acc.push(rendered);";callback(null,compiled)},helpers.include=function(name,template,data,callback){function onRendered(err,rendered){if(err)return callback(err);callback(null,rendered)}template._renderRelative(name,data,null,onRendered)}}),require.register("tags/print.js",function(module,exports,require){var filter=require("../filter"),TAG_REPLACE_RE=/\$\{([^\}]*)\}/g,TAG_PARSE_RE=/^(?:=|html)\s+([^|]+)(?:\|(.*))?$/,FILTER_SPLIT_RE=/\|(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/g,FILTER_SPLIT_ARGS_RE=/\,(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/g,FILTER_MATCH_RE=/^([a-z]+)\s*(?:\((.*)\))?$/i,DEFAULT_VARIABLE_FILTERS=["escapeIfUnsafe"].map(JSON.stringify),DEFAULT_HTML_FILTERS=[];module.exports.tags={};var variableTag=module.exports.tags["="]={},htmlTag=module.exports.tags.html={};variableTag.isBlock=!1,htmlTag.isBlock=!1,variableTag.beforeProcessor=function(source,compiler,callback){source=source.replace(TAG_REPLACE_RE,"{{= $1}}"),callback(null,source)},variableTag.compile=createPrintTagCompiler(DEFAULT_VARIABLE_FILTERS),htmlTag.compile=createPrintTagCompiler(DEFAULT_HTML_FILTERS);function createPrintTagCompiler(defaultFilters){return function(token,compiledContents,compiler,callback){var parsed=token.tag.match(TAG_PARSE_RE);if(!parsed)return callback(new Error("Compilation error: Unable to parse tag `"+token.tag+"`."));var contents=parsed[1],filters=parsed[2]?parseFilters(parsed[2],defaultFilters):defaultFilters,contents="__tools.filter("+contents+", "+"["+filters.join(",")+"]"+")",ret;token.options.strict?ret="__acc.push("+contents+");":ret="try {var __tmp = "+contents+";"+"} catch(__err) {"+"if(__err instanceof ReferenceError) {"+'__tmp = "";'+"} else {"+"throw __err;"+"}"+"}"+"__acc.push(__tmp);",callback(null,ret)}}function parseFilters(filters,defaults){var raw=!1;return filters=filters.split(FILTER_SPLIT_RE).filter(function filterOne(filter){return filter=="raw"?(raw=!0,!1):!0}).map(function mapOne(filter){filter=filter.match(FILTER_MATCH_RE),filter[1]=filter[1].replace('"','"');if(!filter[2])return'"'+filter[1]+'"';var splittedArgs=filter[2].split(FILTER_SPLIT_ARGS_RE);return'["'+filter[1]+'", '+splittedArgs.join(",")+"]"}),raw||(filters=filters.concat(defaults)),_.uniq(filters)}}),require.register("tags/raw.js",function(module,exports,require){var utils=require("../utils"),VERBATIM_RE=/\{\{\s*verbatim\s*\}\}((?:.|\n)*?)\{\{\s*\/\s*verbatim\s*\}\}|{\{\s*raw\s*\}\}((?:.|\n)*?)\{\{\s*\/\s*raw\s*\}\}/g;module.exports.tags={};var verbatimTag=module.exports.tags.verbatim={};verbatimTag.isBlock=!1,verbatimTag.compile=function(token,compiledContents,compiler,callback){var key=parseInt(token.tag.split(" ")[1]);callback(null,'__acc.push("'+utils.escapeCompiledString(compiler.__verbatim[key-1])+'");')},verbatimTag.beforeProcessorPrepend=!0,verbatimTag.beforeProcessor=function(source,compiler,callback){compiler.__verbatim=[],source=source.replace(VERBATIM_RE,function onMatch(all,content1,content2){return compiler.__verbatim.push(content1||content2),"{{verbatim "+compiler.__verbatim.length+"}}"}),callback(null,source)}}),require.register("tags/tmpl.js",function(module,exports,require){var utils=require("../utils"),TAG_PARSE_RE=/^tmpl\s+(.*)$/;module.exports.tags={};var tmplTag=module.exports.tags.tmpl={};tmplTag.isBlock=!1,tmplTag.compile=function(token,compiledContents,compiler,callback){var parsed=token.tag.match(TAG_PARSE_RE);if(!parsed)return callback(new Error("Compilation error: Unable to parse tag `"+token.tag+"`."));var nested=parsed[1];compiler.__compilationEnd.unshift("});"),callback(null,"__template._nest("+nested+", __data, "+"function(err, rendered){"+"__acc.push(rendered);")}}),require.register("template.js",function(module,exports,require){var Cache=CappedCache=require("./cache"),utils=require("./utils"),token=require("./token"),tools=require("./tools"),Compiler=require("./compiler"),filter=require("./filter"),DEFAULTS={lookup:utils.lookupTemplate,load:utils.loadTemplate,path:null,cache:null,cacheHandler:Cache,cacheOptions:[],cacheTmplHandler:CappedCache,cacheTmplOptions:[1e3],useIsolatedTmplCache:!0,cacheContext:null,strict:!0,eachCounters:!0,_parent:null,_cacheAttachment:"_cache",_cacheTmplAttachment:"_nestCache"},TEMPLATE_EXPORTS={filter:filter,utils:utils,tools:tools};function Template(str,options){_.isObject(str)&&!options&&(options=str,str=null),options||(options={}),_.isBoolean(options.cache)||(options&&options.settings?options.cache=options.settings.env!=="development":options.cache=!0),options=_.defaults(options,DEFAULTS),options.cacheContext=options.cacheContext||Template,this.template=str,this.options=options,this._compiled=null;if(options.cache&&!(this._getCache()instanceof options.cacheHandler)){var cacheOptions=[options.cacheHandler].concat(options.cacheOptions);options.cacheContext[options._cacheProp]=typeof window!="undefined"?new options.cacheHandler:construct.apply(this,cacheOptions)}}Template.prototype._getCache=function(){return this.options.cacheContext[this.options._cacheProp]},Template.prototype.loadFile=function(filePath,callback){typeof window!="undefined"&&callback(new Error("Client mode does not support reading from file."))},Template.prototype.render=function(data,callback){_.isFunction(data)&&!callback&&(callback=data,data={});var cacheKey="template::"+this._cacheKey();!this.compiled&&this.options.cache&&(this.compiled=this._getCache().get(cacheKey));if(this._compiled)return this._renderCompiled(data,callback);var _this=this;this._compile(function(err){if(err)return callback(err);_this._renderCompiled(data,callback)})},Template.prototype._renderCompiled=function onRendered(data,callback){this._compiled(this,TEMPLATE_EXPORTS,_,data,token.helpers,callback)},Template.prototype._compile=function(callback){var _this=this;if(!_.isString(this.template))return callback(new Error("Template contents not set"));(new Compiler(this)).compile(function(err,compiled){if(err)return callback(err);_this._compiled=compiled;var cacheKey="template::"+_this._cacheKey();_this.options.cache&&_this._getCache().cache(cacheKey,compiled),callback(null,compiled)})},Template.prototype._nest=function(nested,data,callback){var options=_.clone(this.options);options.useIsolatedTmplCache&&(options._cacheAttachment=options._cacheTmplAttachment,options.cacheHandler=options.cacheTmplHandler,options.cacheOptions=options.cacheTmplOptions),(new Template(nested,options)).render(data,function onDone(err,rendered){if(err)return callback(err);callback(null,rendered)})},Template.prototype._renderRelative=function(name,data,rendered,callback){var _this=this,options=_.clone(this.options);options._parent=rendered;var template=new Template(options),cacheKey="path::"+this._cacheKey()+"::"+name,cachedPath;function onTemplateLocated(err,filePath){if(err)return callback(err);_this.options.cache&&_this._getCache().cache(cacheKey,filePath),template.loadFile(filePath,onTemplateLoaded)}function onTemplateLoaded(err,source){if(err)return callback(err);template.render(data,onTemplateRendered)}function onTemplateRendered(err,result){if(err)return callback(err);callback(null,result)}this.options.cache&&(cachedPath=this._getCache().get(cacheKey)),cachedPath?template.loadFile(cachedPath,onTemplateLoaded):this.options.lookup(name,this,onTemplateLocated)},Template.prototype._cacheKey=function(){return this.options.path||this.template||null},module.exports=Template}),require.register("token.js",function(module,exports,require){var frame,utils=require("./utils"),extend=frame?frame.classes.extend:utils.extend;function BaseToken(root,parent,options){this.parent=parent,this.children=[],this.tag=null,this.tagType=null,this.options=options,this.root=root}BaseToken.prototype.compile=function(compiler,callback){callback(new Error("Stub method BaseToken#compile must be overloaded"))},BaseToken.prototype.lookupTag=function(tag){if(tags[tag])return tags[tag];if(this.tagType&&this.tagType.intermediateTags&&this.tagType.intermediateTags[tag])return this.tagType.intermediateTags[tag].isIntermediate=!0,this.tagType.intermediateTags[tag]};function LiteralToken(literal,root,parent,options){LiteralToken._superclass.call(this,root,parent,options),this.literal=literal}extend(LiteralToken,BaseToken),LiteralToken.prototype.compile=function(compiler,callback){this._compiled='__acc.push("'+utils.escapeCompiledString(this.literal)+'");',callback(null,this._compiled)};function RootToken(children,options){RootToken._superclass.call(this,this,null,options),children||(children=[]),this.head=[],this.children=children}extend(RootToken,BaseToken),RootToken.prototype.compile=function(compiler,callback){var _this=this;function onCompiled(err,compiled){if(err)return callback(err);var compiled="var __acc = [];var __blocks = {};if(__template.options && __template.options._parent) {__blocks = __template.options._parent.blocks;}var __tmp;var __err;__data = __data || {};"+headDeclarations.join("")+"with(__data) {"+compiled+footDeclarations.join("")+'var __compiled = new String(__acc.join(""));'+"__compiled.blocks = __blocks;"+"__callback(null, __compiled);"+compiler.__compilationEnd.join("")+"}";_this._compiled=compiled,callback(null,compiled)}utils.compileTokens(this.children,compiler,onCompiled)};function BlockToken(tag,tagType,root,parent,children,options){BlockToken._superclass.call(this,root,parent,options),this.tag=tag,this.tagType=tagType,children||(children=[]),this.children=children,this.intermediate=[]}extend(BlockToken,BaseToken),BlockToken.prototype.compile=function(compiler,callback){var _this=this,compiledContents,compiledIntermediate;function onContentsCompiled(err,compiled){if(err)return callback(err);compiledContents=compiled,utils.compileTokenArray(_this.intermediate,compiler,onIntermediateCompiled)}function onIntermediateCompiled(err,compiled){if(err)return callback(err);compiledIntermediate=compiled,_this.tagType.compile(_this,compiledContents,compiledIntermediate,compiler,onCompiled)}function onCompiled(err,compiled){if(err)return callback(err);_this._compiled=compiled,callback(null,compiled)}utils.compileTokens(this.children,compiler,onContentsCompiled)};function LeafToken(tag,tagType,root,parent,options){LeafToken._superclass.call(this,root,parent,options),this.tag=tag,this.tagType=tagType}extend(LeafToken,BaseToken),LeafToken.prototype.compile=function(compiler,callback){var _this=this;function onCompiled(err,compiled){if(err)return callback(err);_this._compiled=compiled,callback(null,compiled)}var compiled=this.tagType.compile(this,null,compiler,onCompiled)};function IntermediateToken(tag,tagType,root,parent,children,options){IntermediateToken._superclass.call(this,tag,tagType,root,parent,children,options)}extend(IntermediateToken,BlockToken),IntermediateToken.prototype.compile=function(compiler,callback){var _this=this;function onContentsCompiled(err,compiledContents){if(err)return callback(err);callback(null,compiledContents)}utils.compileTokens(this.children,compiler,onContentsCompiled)},IntermediateToken.prototype.lookupTag=function(tag){return this.parent.lookupTag(tag)},module.exports={headDeclarations:[],BaseToken:BaseToken,RootToken:RootToken,BlockToken:BlockToken,IntermediateToken:IntermediateToken,LeafToken:LeafToken,LiteralToken:LiteralToken};var headDeclarations=module.exports.headDeclarations=[],footDeclarations=module.exports.footDeclarations=[],tags=module.exports.tags={},tagBeforeProcessors=module.exports.tagBeforeProcessors=[],helpers=module.exports.helpers={};function loadTags(loadedFiles){loadedFiles=loadedFiles||frame.files.requireDir(__dirname+"/tags/");for(file in loadedFiles){var fileTags=loadedFiles[file].tags,fileHelpers=loadedFiles[file].helpers;for(tag in fileTags){var currentTag=fileTags[tag];currentTag.beforeProcessor&&(currentTag.beforeProcessorPrepend?tagBeforeProcessors.unshift(currentTag.beforeProcessor):tagBeforeProcessors.push(currentTag.beforeProcessor)),currentTag.headDeclarations&&headDeclarations.push(currentTag.headDeclarations),currentTag.footDeclarations&&footDeclarations.push(currentTag.footDeclarations),tags[tag]=currentTag,currentTag.tagName=tag}fileHelpers&&_.extend(helpers,fileHelpers)}}if(typeof window!="undefined"){var files=["block","comment","each","if","print","raw","tmpl"],acc={};_.each(files,function(file){acc[file]=require("./tags/"+file)}),loadTags(acc)}}),require.register("tools.js",function(module,exports,require){var token=require("./token"),filter=require("./filter"),ARGS_SPLIT_RE=/\s+(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/g;module.exports.createSimpleTag=function createSimpleTag(name,fn){token.helpers[name]=fn,token.tags[name]={compile:function(token,compiledContents,compiler,callback){var splitted=token.tag.split(ARGS_SPLIT_RE);splitted[0]="__data";var args=splitted.join(","),compiled='__acc.push(__tools.tools.escapeIfUnsafe(__helpers["'+name+'"]('+args+")"+"));";callback(null,compiled)}}},module.exports.createFilter=function createFilter(name,fn){filter.filters[name]=fn};var escape=module.exports.escape=function(str){return str.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#146;")};module.exports.safe=function(str){return str instanceof String||(str=new String(str)),str.safe=!0,str},module.exports.escapeIfUnsafe=function(str){return str.safe?str:escape(str)}}),require.register("utils.js",function(module,exports,require){var frame,DEFAULT_FILE_EXTENSION=".kiwi";function tmpAsyncForEach(array,fn,args,callback){typeof args=="function"&&!callback&&(callback=args,args=null),args||(args=[]),array=array.slice(0);function handleProcessedCallback(err){if(err)return callback(err);array.length>0?setTimeout(processOne,0):callback()}function processOne(){var item=array.shift();fn.apply(this,[item].concat(args).concat([handleProcessedCallback]))}array.length>0?setTimeout(processOne,0):callback()}var asyncForEach=frame?frame.asyncForEach:tmpAsyncForEach,apply=module.exports.apply=function(input,processor,args,callback){typeof args=="function"&&!callback&&(callback=args,args=null);function done(err,result){if(err)return callback(err);callback(null,result)}processor.apply(this,[input].concat(args||[]).concat([done]))};module.exports.applyAll=function(input,processors,args,callback){function applyOne(processor,next){apply(input,processor,args||[],function onApplied(err,result){if(err)return next(err);input=result,next()})}function done(err){if(err)return callback(err);callback(null,input)}typeof args=="function"&&!callback&&(callback=args,args=null),asyncForEach(processors,applyOne,done)};function compileTokenArray(tokens,compiler,callback){var acc=[],index=0;function compileOne(token,next){token.compile(compiler,function onCompiled(err,compiled){if(err)return next(err);acc.push(compiled),next(null,compiled)}),index++}function done(err){if(err)return callback(err);callback(null,acc)}asyncForEach(tokens,compileOne,done)}module.exports.compileTokenArray=compileTokenArray,module.exports.compileTokens=function(tokens,compiler,callback){compileTokenArray(tokens,compiler,function(err,compiled){if(err)return callback(err);callback(null,compiled.join(""))})},module.exports.escapeCompiledString=function(str){return str.replace(/([\\"])/g,"\\$1").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")},module.exports.isIterable=function(input){return typeof input=="object"&&!(input instanceof String)},module.exports.extend=function(subclass,superclass){function Dummy(){}Dummy.prototype=superclass.prototype,subclass.prototype=new Dummy,subclass.prototype.constructor=subclass,subclass._superclass=superclass,subclass._superproto=superclass.prototype}}),window.kiwi=require("kiwi")})();